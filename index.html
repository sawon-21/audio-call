<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HoloCall - Futuristic Video Conference</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --neon-blue: #00ddebtesting: #00d4ff;
      --neon-pink: #ff007a;
      --dark-bg: #0a0e1f;
      --holo-light: rgba(255, 255, 255, 0.1);
      --glow: #00d4ff80;
      --accent: #ff007a80;
      --text-light: #e0e7ff;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      height: 100vh;
      background: linear-gradient(135deg, var(--dark-bg), #1a1e3a);
      font-family: 'Orbitron', sans-serif;
      color: var(--text-light);
      overflow: hidden;
      position: relative;
    }

    .holo-container {
      position: relative;
      width: 100%;
      height: 100%;
      background: #000;
      overflow: hidden;
    }

    #remoteVideo, #localVideo {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 20px;
    }

    #localVideo {
      top: 30px;
      right: 30px;
      width: 220px;
      height: 280px;
      border: 2px solid var(--neon-blue);
      box-shadow: 0 0 20px var(--glow);
      z-index: 10;
      transition: transform 0.3s ease;
    }

    #localVideo:hover {
      transform: scale(1.1);
    }

    .holo-nav {
      position: absolute;
      top: 0;
      width: 100%;
      padding: 20px;
      background: linear-gradient(to bottom, var(--holo-light), transparent);
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 15;
    }

    .nav-brand {
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink));
      -webkit-background-clip: text;
      color: transparent;
      text-shadow: 0 0 10px var(--glow);
    }

    .nav-actions {
      display: flex;
      gap: 15px;
    }

    .nav-btn {
      background: var(--holo-light);
      border: 1px solid var(--neon-blue);
      color: var(--text-light);
      padding: 10px 20px;
      border-radius: 50px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 0 10px var(--glow);
    }

    .nav-btn:hover {
      background: var(--neon-blue);
      box-shadow: 0 0 20px var(--glow);
      transform: translateY(-3px);
    }

    .call-info {
      position: absolute;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--holo-light);
      padding: 15px 30px;
      border-radius: 15px;
      border: 1px solid var(--neon-blue);
      text-align: center;
      z-index: 10;
      max-width: 90%;
      box-shadow: 0 0 15px var(--glow);
    }

    .call-info h4 {
      font-size: 1.6rem;
      margin: 0;
      text-shadow: 0 0 8px var(--glow);
    }

    .participants {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-top: 8px;
      font-family: 'Roboto', sans-serif;
    }

    .call-status {
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--holo-light);
      padding: 8px 20px;
      border-radius: 25px;
      margin-top: 10px;
      font-size: 0.85rem;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      box-shadow: 0 0 10px var(--glow);
    }

    .status-idle { background: #6b7280; }
    .status-connecting { background: #f59e0b; animation: pulse 1.5s infinite; }
    .status-active { background: #22c55e; }
    .status-error { background: #ef4444; }

    @keyframes pulse {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.4); opacity: 0.6; }
      100% { transform: scale(1); opacity: 1; }
    }

    .holo-controls {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 20px;
      background: var(--holo-light);
      padding: 15px;
      border-radius: 50px;
      border: 1px solid var(--neon-blue);
      z-index: 15;
      box-shadow: 0 0 20px var(--glow);
    }

    .control-btn {
      width: 65px;
      height: 65px;
      border-radius: 50%;
      border: none;
      font-size: 1.6rem;
      color: var(--text-light);
      background: var(--holo-light);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px var(--glow);
    }

    .control-btn:hover {
      background: var(--neon-blue);
      transform: scale(1.15);
      box-shadow: 0 0 20px var(--glow);
    }

    .control-btn.active {
      background: var(--neon-pink);
      box-shadow: 0 0 20px var(--accent);
    }

    .control-btn.end-call {
      background: #ef4444;
    }

    .control-btn.screen-share {
      background: #22c55e;
    }

    .modal-content {
      background: var(--dark-bg);
      border: 1px solid var(--neon-blue);
      border-radius: 20px;
      color: var(--text-light);
      box-shadow: 0 0 30px var(--glow);
    }

    .form-control {
      background: var(--holo-light);
      border: 1px solid var(--neon-blue);
      color: var(--text-light);
      border-radius: 10px;
      font-family: 'Roboto', sans-serif;
    }

    .form-control:focus {
      border-color: var(--neon-blue);
      box-shadow: 0 0 10px var(--glow);
      background: rgba(255, 255, 255, 0.05);
    }

    .btn-primary {
      background: var(--neon-blue);
      border: none;
      border-radius: 10px;
      transition: all 0.3s ease;
      box-shadow: 0 0 10px var(--glow);
    }

    .btn-primary:hover {
      background: var(--neon-pink);
      box-shadow: 0 0 20px var(--accent);
      transform: translateY(-2px);
    }

    .btn-success {
      background: #22c55e;
      border: none;
      border-radius: 10px;
      box-shadow: 0 0 10px #22c55e80;
    }

    .btn-success:hover {
      background: #16a34a;
      box-shadow: 0 0 20px #16a34a80;
    }

    .toast {
      background: var(--dark-bg);
      border: 1px solid var(--neon-blue);
      border-radius: 15px;
      color: var(--text-light);
      box-shadow: 0 0 15px var(--glow);
    }

    .holo-loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(10, 14, 31, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      visibility: hidden;
      transition: all 0.5s ease;
    }

    .holo-loader.active {
      opacity: 1;
      visibility: visible;
    }

    .spinner {
      width: 100px;
      height: 100px;
      border: 10px solid var(--holo-light);
      border-top-color: var(--neon-blue);
      border-radius: 50%;
      animation: spin 1.2s linear infinite;
      box-shadow: 0 0 30px var(--glow);
    }

    .loader-text {
      margin-top: 20px;
      font-size: 1.2rem;
      text-shadow: 0 0 10px var(--glow);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      #localVideo {
        width: 180px;
        height: 220px;
        top: 20px;
        right: 20px;
      }

      .holo-controls {
        bottom: 30px;
        gap: 15px;
        padding: 12px;
      }

      .control-btn {
        width: 55px;
        height: 55px;
        font-size: 1.4rem;
      }

      .call-info {
        top: 90px;
        padding: 12px 20px;
      }

      .call-info h4 {
        font-size: 1.4rem;
      }

      .nav-brand {
        font-size: 1.5rem;
      }
    }

    @media (max-width: 480px) {
      #localVideo {
        width: 140px;
        height: 180px;
        top: 15px;
        right: 15px;
      }

      .holo-controls {
        bottom: 20px;
        gap: 10px;
        padding: 10px;
      }

      .control-btn {
        width: 50px;
        height: 50px;
        font-size: 1.3rem;
      }

      .call-info {
        top: 80px;
        padding: 10px 15px;
      }

      .call-info h4 {
        font-size: 1.2rem;
      }

      .nav-brand {
        font-size: 1.3rem;
      }

      .nav-btn {
        padding: 8px 15px;
        font-size: 0.85rem;
      }
    }
  </style>
</head>
<body>
  <div class="holo-loader" id="loader">
    <div class="spinner"></div>
    <div class="loader-text">Connecting to HoloCall...</div>
  </div>

  <div class="holo-container">
    <video id="remoteVideo" autoplay playsinline></video>
    <video id="localVideo" autoplay muted playsinline></video>

    <nav class="holo-nav">
      <span class="nav-brand">HoloCall</span>
      <div class="nav-actions">
        <button class="nav-btn" data-bs-toggle="modal" data-bs-target="#roomModal">
          <i class="bi bi-person-lines-fill"></i> Room
        </button>
        <button class="nav-btn" id="infoBtn">
          <i class="bi bi-info-circle-fill"></i> Info
        </button>
      </div>
    </nav>

    <div class="call-info">
      <h4 id="userName">Guest</h4>
      <div class="participants" id="participants">Awaiting connections...</div>
      <div class="call-status">
        <span class="status-dot status-idle"></span>
        <span id="statusText">Idle</span>
      </div>
    </div>

    <div class="holo-controls">
      <button id="muteBtn" class="control-btn" title="Toggle Microphone">
        <i class="bi bi-mic-fill"></i>
      </button>
      <button id="videoBtn" class="control-btn" title="Toggle Video">
        <i class="bi bi-camera-video-fill"></i>
      </button>
      <button id="screenBtn" class="control-btn screen-share" title="Share Screen">
        <i class="bi bi-display-fill"></i>
      </button>
      <button id="endCallBtn" class="control-btn end-call" title="End Call">
        <i class="bi bi-x-circle-fill"></i>
      </button>
    </div>
  </div>

  <!-- Room Modal -->
  <div class="modal fade" id="roomModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Enter HoloCall Room</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="mb-4">
            <label for="nameInput" class="form-label">Your Name</label>
            <input type="text" class="form-control" id="nameInput" placeholder="Enter your name" required>
          </div>
          <div class="mb-4">
            <label for="roomInput" class="form-label">Room ID</label>
            <input type="text" class="form-control" id="roomInput" placeholder="Enter or create room ID" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="createBtn" class="btn btn-primary">Create Room</button>
          <button type="button" id="joinBtn" class="btn btn-success">Join Room</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notification -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="toastMessage"></div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
  <script>
    // Firebase Configuration (Replace with your Firebase project config)
    const firebaseConfig = {
      apiKey: "AIzaSyB4CQ3uiTxrvmbbXM01vcB_LjeW7Lk6ogI",
      authDomain: "adui-3ee05.firebaseapp.com",
      projectId: "adui-3ee05",
      storageBucket: "adui-3ee05.appspot.com",
      messagingSenderId: "766920897994",
      appId: "1:766920897994:web:0cea7f8c206455749bcb33",
      databaseURL: "https://adui-3ee05-default-rtdb.firebaseio.com/"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // DOM Elements
    const remoteVideo = document.getElementById('remoteVideo');
    const localVideo = document.getElementById('localVideo');
    const userNameDisplay = document.getElementById('userName');
    const statusText = document.getElementById('statusText');
    const statusDot = document.querySelector('.status-dot');
    const muteBtn = document.getElementById('muteBtn');
    const videoBtn = document.getElementById('videoBtn');
    const screenBtn = document.getElementById('screenBtn');
    const endCallBtn = document.getElementById('endCallBtn');
    const nameInput = document.getElementById('nameInput');
    const roomInput = document.getElementById('roomInput');
    const createBtn = document.getElementById('createBtn');
    const joinBtn = document.getElementById('joinBtn');
    const toast = new bootstrap.Toast(document.getElementById('toast'));
    const toastMessage = document.getElementById('toastMessage');
    const roomModal = new bootstrap.Modal(document.getElementById('roomModal'));
    const participantsDisplay = document.getElementById('participants');
    const loader = document.getElementById('loader');
    const infoBtn = document.getElementById('infoBtn');

    // State
    let localStream = null;
    let peerConnection = null;
    let screenStream = null;
    let currentRoomId = '';
    let isMuted = false;
    let isVideoOff = false;
    let isScreenSharing = false;
    let currentUserName = '';
    let participants = [];

    // WebRTC Configuration
    const rtcConfig = {
      iceServers: [
        { urls: 'stun:stun.l.google.com:19302' },
        { urls: 'stun:stun1.l.google.com:19302' },
        { urls: 'stun:stun2.l.google.com:19302' },
        { urls: 'stun:stun3.l.google.com:19302' },
        { urls: 'stun:stun4.l.google.com:19302' }
      ]
    };

    // Initialize
    initialize();

    function initialize() {
      setupEventListeners();
      checkMediaPermissions();
      roomModal.show();
    }

    function setupEventListeners() {
      muteBtn.addEventListener('click', toggleMute);
      videoBtn.addEventListener('click', toggleVideo);
      screenBtn.addEventListener('click', toggleScreenShare);
      endCallBtn.addEventListener('click', endCall);
      createBtn.addEventListener('click', () => startCall(true));
      joinBtn.addEventListener('click', () => startCall(false));
      infoBtn.addEventListener('click', () => showToast('HoloCall v1.0 - Futuristic Video Conferencing'));
      window.addEventListener('beforeunload', cleanup);
    }

    async function checkMediaPermissions() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
        stream.getTracks().forEach(track => track.stop());
      } catch (err) {
        showToast('Camera and microphone access required');
        console.error('Permission error:', err);
      }
    }

    async function startCall(isCreator) {
      const name = nameInput.value.trim();
      const roomId = roomInput.value.trim();

      if (!name) {
        showToast('Please enter your name');
        return;
      }
      if (!roomId) {
        showToast('Please enter a room ID');
        return;
      }

      currentUserName = name;
      currentRoomId = roomId;
      userNameDisplay.textContent = name;
      roomModal.hide();
      loader.classList.add('active');

      try {
        localStream = await navigator.mediaDevices.getUserMedia({
          video: {
            width: { ideal: 1920 },
            height: { ideal: 1080 },
            frameRate: { ideal: 60 }
          },
          audio: {
            echoCancellation: true,
            noiseSuppression: true,
            autoGainControl: true
          }
        });

        localVideo.srcObject = localStream;
        updateStatus(isCreator ? 'Initializing room...' : 'Joining room...', 'status-connecting');

        peerConnection = new RTCPeerConnection(rtcConfig);

        localStream.getTracks().forEach(track => peerConnection.addTrack(track, localStream));

        peerConnection.ontrack = ({ streams }) => {
          remoteVideo.srcObject = streams[0];
          updateStatus('Connected', 'status-active');
          showToast('HoloCall established');
          loader.classList.remove('active');
        };

        peerConnection.onicecandidate = event => {
          if (event.candidate) {
            db.ref(`holocalls/${roomId}/ice`).push(event.candidate.toJSON());
          }
        };

        peerConnection.oniceconnectionstatechange = () => {
          if (peerConnection.iceConnectionState === 'disconnected') {
            updateStatus('Disconnected', 'status-error');
            showToast('Connection lost');
            loader.classList.remove('active');
          }
        };

        const roomRef = db.ref(`holocalls/${roomId}`);

        await roomRef.child('participants').push(name);
        roomRef.child('participants').on('value', snapshot => {
          if (snapshot.exists()) {
            participants = Object.values(snapshot.val()).filter(p => p !== name);
            updateParticipantsDisplay();
          }
        });

        if (isCreator) {
          const offer = await peerConnection.createOffer();
          await peerConnection.setLocalDescription(offer);
          await roomRef.child('offer').set(offer);

          roomRef.child('answer').on('value', async snapshot => {
            if (snapshot.exists() && peerConnection.signalingState !== 'stable') {
              const answer = snapshot.val();
              await peerConnection.setRemoteDescription(answer);
            }
          });

          setTimeout(() => roomRef.remove(), 3600000);
        } else {
          const offerSnapshot = await roomRef.child('offer').get();
          if (!offerSnapshot.exists()) {
            updateStatus('Room not found', 'status-error');
            showToast('Room does not exist');
            loader.classList.remove('active');
            return;
          }

          const offer = offerSnapshot.val();
          await peerConnection.setRemoteDescription(offer);

          const answer = await peerConnection.createAnswer();
          await peerConnection.setLocalDescription(answer);
          await roomRef.child('answer').set(answer);
        }

        roomRef.child('ice').on('child_added', async snapshot => {
          const candidate = snapshot.val();
          await peerConnection.addIceCandidate(candidate);
        });

      } catch (err) {
        console.error('Setup error:', err);
        updateStatus('Error', 'status-error');
        showToast(`Failed to initialize: ${err.message}`);
        cleanup();
        loader.classList.remove('active');
      }
    }

    function toggleMute() {
      if (!localStream) return;
      isMuted = !isMuted;
      localStream.getAudioTracks().forEach(track => track.enabled = !isMuted);
      muteBtn.innerHTML = `<i class="bi ${isMuted ? 'bi-mic-mute-fill' : 'bi-mic-fill'}"></i>`;
      muteBtn.classList.toggle('active', isMuted);
      muteBtn.title = isMuted ? 'Unmute Microphone' : 'Mute Microphone';
      showToast(isMuted ? 'Microphone muted' : 'Microphone unmuted');
    }

    function toggleVideo() {
      if (!localStream) return;
      isVideoOff = !isVideoOff;
      localStream.getVideoTracks().forEach(track => track.enabled = !isVideoOff);
      videoBtn.innerHTML = `<i class="bi ${isVideoOff ? 'bi-camera-video-off-fill' : 'bi-camera-video-fill'}"></i>`;
      videoBtn.classList.toggle('active', isVideoOff);
      videoBtn.title = isVideoOff ? 'Enable Video' : 'Disable Video';
      showToast(isVideoOff ? 'Video disabled' : 'Video enabled');
    }

    async function toggleScreenShare() {
      if (isScreenSharing) {
        stopScreenShare();
      } else {
        startScreenShare();
      }
    }

    async function startScreenShare() {
      try {
        screenStream = await navigator.mediaDevices.getDisplayMedia({
          video: {
            width: { ideal: 1920 },
            height: { ideal: 1080 },
            frameRate: { ideal: 30 }
          }
        });

        const videoTrack = screenStream.getVideoTracks()[0];
        const sender = peerConnection.getSenders().find(s => s.track?.kind === 'video');

        if (sender) {
          await sender.replaceTrack(videoTrack);
        }

        localVideo.srcObject = screenStream;
        isScreenSharing = true;
        screenBtn.innerHTML = '<i class="bi bi-stop-circle-fill"></i>';
        screenBtn.classList.add('active');
        screenBtn.title = 'Stop Screen Share';
        showToast('Screen sharing activated');

        videoTrack.onended = stopScreenShare;
      } catch (err) {
        console.error('Screen share error:', err);
        showToast('Failed to share screen');
      }
    }

    async function stopScreenShare() {
      if (!screenStream || !localStream) return;

      const videoTrack = localStream.getVideoTracks()[0];
      const sender = peerConnection.getSenders().find(s => s.track?.kind === 'video');

      if (sender) {
        await sender.replaceTrack(videoTrack);
      }

      screenStream.getTracks().forEach(track => track.stop());
      screenStream = null;
      localVideo.srcObject = localStream;

      isScreenSharing = false;
      screenBtn.innerHTML = '<i class="bi bi-display-fill"></i>';
      screenBtn.classList.remove('active');
      screenBtn.title = 'Share Screen';
      showToast('Screen sharing stopped');
    }

    function endCall() {
      if (peerConnection) {
        peerConnection.close();
        peerConnection = null;
      }

      if (currentRoomId) {
        db.ref(`holocalls/${currentRoomId}`).off();
        db.ref(`holocalls/${currentRoomId}`).remove();
      }

      if (localStream) {
        localStream.getTracks().forEach(track => track.stop());
        localStream = null;
      }

      if (screenStream) {
        screenStream.getTracks().forEach(track => track.stop());
        screenStream = null;
      }

      remoteVideo.srcObject = null;
      localVideo.srcObject = null;

      updateStatus('Idle', 'status-idle');
      participants = [];
      currentRoomId = '';
      isMuted = false;
      isVideoOff = false;
      isScreenSharing = false;

      muteBtn.innerHTML = '<i class="bi bi-mic-fill"></i>';
      muteBtn.classList.remove('active');
      muteBtn.title = 'Mute Microphone';
      videoBtn.innerHTML = '<i class="bi bi-camera-video-fill"></i>';
      videoBtn.classList.remove('active');
      videoBtn.title = 'Disable Video';
      screenBtn.innerHTML = '<i class="bi bi-display-fill"></i>';
      screenBtn.classList.remove('active');
      screenBtn.title = 'Share Screen';

      updateParticipantsDisplay();
      showToast('HoloCall terminated');
      roomModal.show();
    }

    function cleanup() {
      endCall();
    }

    function updateStatus(text, statusClass) {
      statusText.textContent = text;
      statusDot.className = 'status-dot';
      if (statusClass) {
        statusDot.classList.add(statusClass);
      }
    }

    function updateParticipantsDisplay() {
      participantsDisplay.textContent = participants.length > 0
        ? `Connected: ${participants.join(', ')}`
        : 'Awaiting connections...';
    }

    function showToast(message) {
      toastMessage.textContent = message;
      toast.show();
      setTimeout(() => toast.hide(), 3500);
    }
  </script>
</body>
</html>